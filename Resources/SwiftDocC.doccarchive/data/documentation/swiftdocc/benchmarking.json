{"kind":"article","sections":[],"primaryContentSections":[{"kind":"content","content":[{"text":"Overview","anchor":"overview","level":2,"type":"heading"},{"inlineContent":[{"text":"DocC has metric logging built right in; it is disabled by default but it can be enabled easily via an environment variable or when running the tools in the ","type":"text"},{"type":"codeVoice","code":"bin\/benchmark"},{"type":"text","text":" Swift package."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When you are working on a PR to add a feature or fix a bug you should evaluate the performance cost of your code changes."}]},{"type":"heading","level":2,"anchor":"Running-a-benchmark","text":"Running a benchmark"},{"type":"paragraph","inlineContent":[{"type":"text","text":"To benchmark the "},{"type":"codeVoice","code":"convert"},{"text":" command with a given documentation bundle ","type":"text"},{"type":"codeVoice","code":"MyFramework.docc"},{"text":" run:","type":"text"}]},{"type":"codeListing","syntax":null,"code":["swift run --package-path bin\/benchmark benchmark --docc-arguments convert MyFramework.docc"]},{"inlineContent":[{"text":"The tool will enable metrics logging, do five sequential runs of the ","type":"text"},{"type":"codeVoice","code":"convert"},{"text":" command with the given inputs and options, and write the results to a JSON file on disk.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"For pull requests where you want to compare the local changes against another version of the—the HEAD commits of the branch that the pull request is targeting—you can use the "},{"code":"compare-against-commit","type":"codeVoice"},{"text":" tool:","type":"text"}],"type":"paragraph"},{"syntax":null,"code":["swift run --package-path bin\/benchmark benchmark compare-to <commit-ish> --docc-arguments convert MyFramework.docc"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"This tool will gather metrics for both the local changes (same as the default "},{"type":"codeVoice","code":"measure"},{"type":"text","text":" tool) and for the other commit of docc, write both results to JSON files on disk, and perform a statistical analysis comparing the two benchmark results."}],"type":"paragraph"},{"inlineContent":[{"text":"If the analysis shows results that you want to investigate further and you want to continue comparing to the same baseline results from the other commit, you can switch to the ","type":"text"},{"type":"codeVoice","code":"measure"},{"type":"text","text":" tool and pass the "},{"type":"codeVoice","code":"benchmark-<commit-hash>.json"},{"text":" file for the ","type":"text"},{"type":"codeVoice","code":"--base-benchmark"},{"text":" argument.","type":"text"}],"type":"paragraph"},{"syntax":null,"code":["swift run --package-path bin\/benchmark benchmark measure --base-benchmark benchmark-<commit-hash>.json --docc-arguments convert MyFramework.docc"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This will only gather new metrics for the local changes, as you iterate, but will still compare the new metrics against the results from the other commit and output the comparison of the two benchmark results."}]},{"type":"heading","level":2,"anchor":"Adding-a-Custom-Metric","text":"Adding a Custom Metric"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When you work on a particular feature and you want to track a given custom metric you can temporarily add it to the log."}]},{"inlineContent":[{"text":"For example, to add a metric that counts the registered bundles, create a ","type":"text"},{"type":"codeVoice","code":"BundlesCount"},{"text":" class that adopts the ","type":"text"},{"type":"reference","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/BenchmarkMetric","isActive":true},{"type":"text","text":" protocol:"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["class BundlesCount: BenchmarkMetric {","  static let identifier = \"bundles-count\"","  static let displayName = \"Bundles Count\"","  ","  var result: MetricValue?","  ","  init(context: DocumentationContext) {","    result = .number(Double(context.registeredBundles.count))","  }","}"]},{"inlineContent":[{"text":"Add your custom metric to the default log by using ","type":"text"},{"isActive":true,"identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/benchmark(add:benchmarkLog:)","type":"reference"},{"text":":","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["benchmark(add: BundlesCount(context: context))"]}]}],"variants":[{"paths":["\/documentation\/swiftdocc\/benchmarking"],"traits":[{"interfaceLanguage":"swift"}]}],"schemaVersion":{"patch":0,"minor":3,"major":0},"metadata":{"roleHeading":"API Collection","modules":[{"name":"SwiftDocC"}],"role":"collectionGroup","title":"Benchmarking"},"topicSections":[{"anchor":"Benchmark-Log","title":"Benchmark Log","identifiers":["doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark","doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/main"]},{"identifiers":["doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/Duration","doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/DataDirectoryOutputSize","doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/IndexDirectoryOutputSize","doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/PeakMemory","doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/TopicGraphHash","doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/ExternalTopicsHash"],"anchor":"Default-Metrics","title":"Default Metrics"},{"identifiers":["doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/benchmark(add:benchmarkLog:)","doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/benchmark(begin:benchmarkLog:)","doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/benchmark(end:benchmarkLog:)","doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/benchmark(wrap:benchmarkLog:body:)"],"title":"Logging Metrics","anchor":"Logging-Metrics"}],"seeAlsoSections":[{"identifiers":["doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/EmittingDiagnostics","doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/StaticAnalysis"],"title":"Diagnostics and Analysis","generated":true,"anchor":"Diagnostics-and-Analysis"}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmarking"},"hierarchy":{"paths":[["doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC"]]},"abstract":[{"text":"Produce performance metrics to improve the compilation pipeline and track regressions.","type":"text"}],"references":{"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/Benchmark/DataDirectoryOutputSize":{"fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"DataDirectoryOutputSize"}],"abstract":[{"type":"text","text":"Measures the output size of the data subdirectory in a DocC archive."}],"role":"symbol","navigatorTitle":[{"text":"DataDirectoryOutputSize","kind":"identifier"}],"kind":"symbol","url":"\/documentation\/swiftdocc\/benchmark\/datadirectoryoutputsize","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/DataDirectoryOutputSize","title":"Benchmark.DataDirectoryOutputSize","type":"topic"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/BenchmarkMetric":{"abstract":[{"type":"text","text":"A generic, named metric."}],"kind":"symbol","url":"\/documentation\/swiftdocc\/benchmarkmetric","navigatorTitle":[{"kind":"identifier","text":"BenchmarkMetric"}],"type":"topic","title":"BenchmarkMetric","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/BenchmarkMetric","fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"BenchmarkMetric","kind":"identifier"}],"role":"symbol"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/benchmark(end:benchmarkLog:)":{"identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/benchmark(end:benchmarkLog:)","title":"benchmark(end:benchmarkLog:)","role":"symbol","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"benchmark"},{"text":"<","kind":"text"},{"kind":"genericParameter","text":"E"},{"text":">(","kind":"text"},{"kind":"externalParam","text":"end"},{"kind":"text","text":": "},{"text":"@autoclosure","kind":"attribute"},{"kind":"text","text":" () -> "},{"preciseIdentifier":"s:9SwiftDocC9benchmark3end0C3LogyxSgyXK_AA9BenchmarkCtAA0F11BlockMetricRzlF1EL_xmfp","kind":"typeIdentifier","text":"E"},{"text":"?, ","kind":"text"},{"text":"benchmarkLog","kind":"externalParam"},{"text":": ","kind":"text"},{"preciseIdentifier":"s:9SwiftDocC9BenchmarkC","text":"Benchmark","kind":"typeIdentifier"},{"kind":"text","text":")"}],"abstract":[{"text":"Ends the given metric and adds it to the log.","type":"text"}],"kind":"symbol","url":"\/documentation\/swiftdocc\/benchmark(end:benchmarklog:)","type":"topic"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/Benchmark":{"type":"topic","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"text":"Benchmark","kind":"identifier"}],"navigatorTitle":[{"text":"Benchmark","kind":"identifier"}],"kind":"symbol","role":"symbol","abstract":[{"type":"text","text":"A logger that runs benchmarks and stores the results."}],"title":"Benchmark","url":"\/documentation\/swiftdocc\/benchmark"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/Benchmark/PeakMemory":{"type":"topic","kind":"symbol","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/PeakMemory","role":"symbol","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"PeakMemory","kind":"identifier"}],"abstract":[{"type":"text","text":"A peak memory footprint metric for the current process."}],"navigatorTitle":[{"text":"PeakMemory","kind":"identifier"}],"title":"Benchmark.PeakMemory","url":"\/documentation\/swiftdocc\/benchmark\/peakmemory"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/Benchmark/main":{"title":"main","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/main","role":"symbol","abstract":[{"type":"text","text":"The shared instance to use for logging."}],"kind":"symbol","type":"topic","fragments":[{"text":"static","kind":"keyword"},{"kind":"text","text":" "},{"text":"let","kind":"keyword"},{"text":" ","kind":"text"},{"text":"main","kind":"identifier"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:9SwiftDocC9BenchmarkC","text":"Benchmark"}],"url":"\/documentation\/swiftdocc\/benchmark\/main"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/Benchmark/Duration":{"title":"Benchmark.Duration","role":"symbol","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/Duration","fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"kind":"identifier","text":"Duration"}],"url":"\/documentation\/swiftdocc\/benchmark\/duration","navigatorTitle":[{"kind":"identifier","text":"Duration"}],"type":"topic","kind":"symbol","abstract":[{"type":"text","text":"A duration metric in milliseconds."}]},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/EmittingDiagnostics":{"url":"\/documentation\/swiftdocc\/emittingdiagnostics","kind":"article","role":"collectionGroup","title":"Emitting Diagnostics","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/EmittingDiagnostics","abstract":[{"type":"text","text":"Vend warnings and errors as part of an operation’s result."}],"type":"topic"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/benchmark(begin:benchmarkLog:)":{"fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"benchmark"},{"text":"<","kind":"text"},{"text":"E","kind":"genericParameter"},{"kind":"text","text":">("},{"text":"begin","kind":"externalParam"},{"kind":"text","text":": "},{"kind":"attribute","text":"@autoclosure"},{"text":" () -> ","kind":"text"},{"preciseIdentifier":"s:9SwiftDocC9benchmark5begin0C3LogxSgxyXK_AA9BenchmarkCtAA0F11BlockMetricRzlF1EL_xmfp","text":"E","kind":"typeIdentifier"},{"text":", ","kind":"text"},{"text":"benchmarkLog","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"Benchmark","kind":"typeIdentifier","preciseIdentifier":"s:9SwiftDocC9BenchmarkC"},{"text":") -> ","kind":"text"},{"kind":"typeIdentifier","text":"E","preciseIdentifier":"s:9SwiftDocC9benchmark5begin0C3LogxSgxyXK_AA9BenchmarkCtAA0F11BlockMetricRzlF1EL_xmfp"},{"kind":"text","text":"?"}],"identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/benchmark(begin:benchmarkLog:)","kind":"symbol","type":"topic","title":"benchmark(begin:benchmarkLog:)","abstract":[{"text":"Begins the given metric.","type":"text"}],"url":"\/documentation\/swiftdocc\/benchmark(begin:benchmarklog:)","role":"symbol"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/Benchmark/IndexDirectoryOutputSize":{"fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"text":"IndexDirectoryOutputSize","kind":"identifier"}],"type":"topic","title":"Benchmark.IndexDirectoryOutputSize","url":"\/documentation\/swiftdocc\/benchmark\/indexdirectoryoutputsize","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/IndexDirectoryOutputSize","navigatorTitle":[{"text":"IndexDirectoryOutputSize","kind":"identifier"}],"abstract":[{"text":"Measures the output size of the index subdirectory in a DocC archive.","type":"text"}],"kind":"symbol","role":"symbol"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/benchmark(add:benchmarkLog:)":{"role":"symbol","kind":"symbol","type":"topic","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/benchmark(add:benchmarkLog:)","title":"benchmark(add:benchmarkLog:)","abstract":[{"text":"Logs a one-off metric value.","type":"text"}],"url":"\/documentation\/swiftdocc\/benchmark(add:benchmarklog:)","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"text":"benchmark","kind":"identifier"},{"text":"<","kind":"text"},{"text":"E","kind":"genericParameter"},{"text":">(","kind":"text"},{"text":"add","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"@autoclosure","kind":"attribute"},{"kind":"text","text":" () -> "},{"kind":"typeIdentifier","text":"E","preciseIdentifier":"s:9SwiftDocC9benchmark3add0C3LogyxyXK_AA9BenchmarkCtAA0F6MetricRzlF1EL_xmfp"},{"text":", ","kind":"text"},{"kind":"externalParam","text":"benchmarkLog"},{"text":": ","kind":"text"},{"preciseIdentifier":"s:9SwiftDocC9BenchmarkC","text":"Benchmark","kind":"typeIdentifier"},{"text":")","kind":"text"}]},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/StaticAnalysis":{"role":"collectionGroup","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/StaticAnalysis","abstract":[{"text":"Run static analysis checks on markup files.","type":"text"}],"url":"\/documentation\/swiftdocc\/staticanalysis","title":"Static Analysis","kind":"article","type":"topic"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC":{"role":"collection","abstract":[{"type":"text","text":"Combine code comments with markup prose to produce structured, semantic documentation."}],"kind":"symbol","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC","type":"topic","url":"\/documentation\/swiftdocc","title":"SwiftDocC"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/Benchmark/ExternalTopicsHash":{"kind":"symbol","abstract":[{"type":"text","text":"A hash metric produced off the externally resolved links."}],"fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"kind":"identifier","text":"ExternalTopicsHash"}],"url":"\/documentation\/swiftdocc\/benchmark\/externaltopicshash","role":"symbol","title":"Benchmark.ExternalTopicsHash","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/ExternalTopicsHash","navigatorTitle":[{"kind":"identifier","text":"ExternalTopicsHash"}],"type":"topic"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/Benchmark/TopicGraphHash":{"url":"\/documentation\/swiftdocc\/benchmark\/topicgraphhash","abstract":[{"text":"A hash metric produced off the given documentation context.","type":"text"}],"fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"kind":"identifier","text":"TopicGraphHash"}],"identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/Benchmark\/TopicGraphHash","type":"topic","navigatorTitle":[{"kind":"identifier","text":"TopicGraphHash"}],"kind":"symbol","title":"Benchmark.TopicGraphHash","role":"symbol"},"doc://swift-docc.SwiftDocC/documentation/SwiftDocC/benchmark(wrap:benchmarkLog:body:)":{"url":"\/documentation\/swiftdocc\/benchmark(wrap:benchmarklog:body:)","kind":"symbol","identifier":"doc:\/\/swift-docc.SwiftDocC\/documentation\/SwiftDocC\/benchmark(wrap:benchmarkLog:body:)","abstract":[],"title":"benchmark(wrap:benchmarkLog:body:)","type":"topic","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"benchmark"},{"text":"<","kind":"text"},{"text":"E","kind":"genericParameter"},{"kind":"text","text":", "},{"text":"Result","kind":"genericParameter"},{"text":">(","kind":"text"},{"text":"wrap","kind":"externalParam"},{"text":": ","kind":"text"},{"kind":"attribute","text":"@autoclosure"},{"text":" () -> ","kind":"text"},{"text":"E","kind":"typeIdentifier","preciseIdentifier":"s:9SwiftDocC9benchmark4wrap0C3Log4bodyq_xyXK_AA9BenchmarkCq_yKXEtKAA0G11BlockMetricRzr0_lF1EL_xmfp"},{"text":", ","kind":"text"},{"text":"benchmarkLog","kind":"externalParam"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"Benchmark","preciseIdentifier":"s:9SwiftDocC9BenchmarkC"},{"text":", ","kind":"text"},{"kind":"externalParam","text":"body"},{"kind":"text","text":": () "},{"text":"throws","kind":"keyword"},{"kind":"text","text":" -> "},{"text":"Result","preciseIdentifier":"s:9SwiftDocC9benchmark4wrap0C3Log4bodyq_xyXK_AA9BenchmarkCq_yKXEtKAA0G11BlockMetricRzr0_lF6ResultL_q_mfp","kind":"typeIdentifier"},{"kind":"text","text":") "},{"text":"rethrows","kind":"keyword"},{"text":" -> ","kind":"text"},{"preciseIdentifier":"s:9SwiftDocC9benchmark4wrap0C3Log4bodyq_xyXK_AA9BenchmarkCq_yKXEtKAA0G11BlockMetricRzr0_lF6ResultL_q_mfp","kind":"typeIdentifier","text":"Result"}],"role":"symbol"}}}